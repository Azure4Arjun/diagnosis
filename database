USE [master]
GO

--ALTER DATABASE [SONAR_QUBE] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
--GO
--/****** Object:  Database [SONAR_QUBE]    Script Date: 27/06/2018 17:06:22 ******/
--DROP DATABASE [SONAR_QUBE]
--GO

CREATE DATABASE [SONAR_QUBE]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'SONAR_QUBE', FILENAME = N'D:\MSSQL\DATA\@@@DATABASE@@@\SONAR_QUBE.mdf' , SIZE = 5120KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'SONAR_QUBE_log', FILENAME = N'F:\MSSQL\LOGS\@@@DATABASE@@@\SONAR_QUBE_log.ldf' , SIZE = 2048KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
/*@ IMPORTANTE @*/
COLLATE Latin1_General_CS_AS
/*@ IMPORTANTE @*/
GO
ALTER DATABASE [SONAR_QUBE] SET COMPATIBILITY_LEVEL = 130
GO
ALTER DATABASE [SONAR_QUBE] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET ARITHABORT OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF)
GO
ALTER DATABASE [SONAR_QUBE] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [SONAR_QUBE] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [SONAR_QUBE] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET  DISABLE_BROKER 
GO
ALTER DATABASE [SONAR_QUBE] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [SONAR_QUBE] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [SONAR_QUBE] SET  READ_WRITE 
GO
ALTER DATABASE [SONAR_QUBE] SET RECOVERY FULL 
GO
ALTER DATABASE [SONAR_QUBE] SET  MULTI_USER 
GO
ALTER DATABASE [SONAR_QUBE] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [SONAR_QUBE] SET TARGET_RECOVERY_TIME = 0 SECONDS 
GO
ALTER DATABASE [SONAR_QUBE] SET DELAYED_DURABILITY = DISABLED 
GO
USE [SONAR_QUBE]
GO
ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
GO
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
GO
ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
GO
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
GO
ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
GO
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
GO
ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
GO
ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
GO
USE [SONAR_QUBE]
GO
IF NOT EXISTS (SELECT name FROM sys.filegroups WHERE is_default=1 AND name = N'PRIMARY') ALTER DATABASE [SONAR_QUBE] MODIFY FILEGROUP [PRIMARY] DEFAULT
GO


-- USE [master]
-- GO

-- --ALTER DATABASE [SONAR_QUBE] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
-- --GO
-- --/****** Object:  Database [SONAR_QUBE]    Script Date: 27/06/2018 17:06:22 ******/
-- --DROP DATABASE [SONAR_QUBE]
-- --GO


-- /****** Object:  Database [SONAR_QUBE]    Script Date: 27/06/2018 17:06:22 ******/
-- CREATE DATABASE [SONAR_QUBE]
--  CONTAINMENT = NONE
--  ON  PRIMARY 
-- ( NAME = N'SONAR_QUBE', FILENAME = N'D:\MSSQL\DATA\@@@DATABASE@@@\SONAR_QUBE.MDF' , SIZE = 698048KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
--  LOG ON 
-- ( NAME = N'SONAR_QUBE_log', FILENAME = N'F:\MSSQL\LOGS\@@@DATABASE@@@\SONAR_QUBE_LOG.LDF' , SIZE = 685568KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
-- /*@ IMPORTANTE @*/
-- COLLATE Latin1_General_CS_AS
-- /*@ IMPORTANTE @*/
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET COMPATIBILITY_LEVEL = 130
-- GO

-- IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
-- begin
-- EXEC [SONAR_QUBE].[dbo].[sp_fulltext_database] @action = 'enable'
-- end
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ANSI_NULL_DEFAULT OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ANSI_NULLS OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ANSI_PADDING OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ANSI_WARNINGS OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ARITHABORT OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET AUTO_CLOSE OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET AUTO_SHRINK OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET AUTO_UPDATE_STATISTICS ON 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET CURSOR_CLOSE_ON_COMMIT OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET CURSOR_DEFAULT  GLOBAL 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET CONCAT_NULL_YIELDS_NULL OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET NUMERIC_ROUNDABORT OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET QUOTED_IDENTIFIER OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET RECURSIVE_TRIGGERS OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET  DISABLE_BROKER 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET DATE_CORRELATION_OPTIMIZATION OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET TRUSTWORTHY OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET ALLOW_SNAPSHOT_ISOLATION OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET PARAMETERIZATION SIMPLE 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET READ_COMMITTED_SNAPSHOT OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET HONOR_BROKER_PRIORITY OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET RECOVERY FULL 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET  MULTI_USER 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET PAGE_VERIFY CHECKSUM  
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET DB_CHAINING OFF 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET TARGET_RECOVERY_TIME = 0 SECONDS 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET DELAYED_DURABILITY = DISABLED 
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET QUERY_STORE = OFF
-- GO

-- USE [SONAR_QUBE]
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
-- GO

-- ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
-- GO

-- ALTER DATABASE [SONAR_QUBE] SET  READ_WRITE 
-- GO


 sonar-install.sh
# /opt/sonarqube-v6.4/conf/sonar.properties
# /opt/sonarqube-v6.4/bin/linux-x86-64/sonar.sh start

# sonar.jdbc.username=sonarqube
# sonar.jdbc.password=AQswDE123@
# sonar.jdbc.url=jdbc:mysql://172.16.6.130:3306/sonarqube?useUnicode=true&characterEncoding=utf8&rewriteBatchedStatements=true&useConfigs=maxPerformance
9532a0127b3b92a5bf691a95190c8501c92d6e7e

cd /opt

wget https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-7.2.zip
yum install unzip -y
yum install java-1.8.0-openjdk -y
unzip sonarqube-7.2.zip

useradd sonar -p qwe123@
groupadd sonar
usermod -a -G sonar sonar
chown -R sonar:sonar ./sonarqube-7.2

vim /opt/sonarqube-7.2/conf/sonar.properties
  --------------------
  sonar.jdbc.username=sonar_qube
  sonar.jdbc.password=sonar_qube123@
  sonar.jdbc.url=jdbc:sqlserver://172.16.0.71:49241;databaseName=SONAR_QUBE
  sonar.web.host=0.0.0.0
  sonar.web.port=9000
  sonar.web.javaOpts=-server -Xms512m -Xmx1024m -XX:+HeapDumpOnOutOfMemoryError -XX:+UseStringDeduplication
  sonar.ce.javaOpts=-server -Xms512m -Xmx1024m -XX:+HeapDumpOnOutOfMemoryError -XX:+UseStringDeduplication
  sonar.search.javaOpts=-server -Xms512m -Xmx1024m -XX:+HeapDumpOnOutOfMemoryError -XX:+UseStringDeduplication
  --------------------

vim /opt/sonarqube/conf/wrapper.conf
  --------------------
  wrapper.java.maxmemory=128
  wrapper.java.additional.5=-server
  wrapper.java.additional.23=-XX:+UseStringDeduplication
  --------------------

vim /opt/sonarqube-7.2/bin/linux-x86-64/sonar.sh
  --------------------
  RUN_AS_USER=sonar
  --------------------

/opt/sonarqube-7.2/bin/linux-x86-64/sonar.sh start


vim /etc/init.d/sonar
  ------------------
  #!/bin/sh
  #
  # rc file for SonarQube
  #
  # chkconfig: 345 96 10
  # description: SonarQube system (www.sonarsource.org)
  #
  ### BEGIN INIT INFO
  # Provides: sonar
  # Required-Start: $network
  # Required-Stop: $network
  # Default-Start: 3 4 5
  # Default-Stop: 0 1 2 6
  # Short-Description: SonarQube system (www.sonarsource.org)
  # Description: SonarQube system (www.sonarsource.org)
  ### END INIT INFO

  /usr/bin/sonar $*
  ------------------

ln -s /opt/sonarqube-7.2 /opt/sonarqube
ln -s /opt/sonarqube/bin/linux-x86-64/sonar.sh /usr/bin/sonar
chmod 755 /etc/init.d/sonar
chkconfig --add sonar


systemctl enable sonar
systemctl start sonar



# https://github.com/racodond/sonar-css-plugin
